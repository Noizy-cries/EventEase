@page "/event/{EventId:int}"
@using EventEase.Models
@using EventEase.Services
@inject EventService EventService
@inject NavigationManager NavigationManager

<PageTitle>EventEase - @eventItem?.Name</PageTitle>

@if (isLoading)
{
    <div class="loading">Loading event details...</div>
}
else if (eventItem != null)
{
    <div class="event-details">
        <h1>@eventItem.Name</h1>
        
        <div class="details-grid">
            <div class="detail-item">
                <strong>Date:</strong>
                <span>@eventItem.Date.ToString("dddd, MMMM dd, yyyy")</span>
            </div>
            
            <div class="detail-item">
                <strong>Time:</strong>
                <span>@eventItem.Time.ToString(@"hh\:mm")</span>
            </div>
            
            <div class="detail-item">
                <strong>Location:</strong>
                <span>@eventItem.Location</span>
            </div>
            
            <div class="detail-item">
                <strong>Available Spots:</strong>
                <span>@eventItem.AvailableSpots out of @eventItem.TotalSpots</span>
            </div>
        </div>
        
        <div class="description">
            <h3>Description</h3>
            <p>@eventItem.Description</p>
        </div>
        
        <div class="actions">
            <button class="btn btn-primary" @onclick="GoBack">
                Back to Events
            </button>
            <button class="btn btn-success" @onclick="Register">
                Register Now
            </button>
        </div>
    </div>
}
else
{
    <div class="not-found">
        <h1>Event Not Found</h1>
        <p>The requested event could not be found.</p>
        <button class="btn btn-primary" @onclick="GoBack">Back to Events</button>
    </div>
}

@code {
    [Parameter]
    public int EventId { get; set; }

    private Event? eventItem;
    private bool isLoading = true;

    protected override async Task OnParametersSetAsync()
    {
        if (EventId <= 0)
        {
            NavigationManager.NavigateTo("/");
            return;
        }
        
        isLoading = true;
        eventItem = await EventService.GetEventAsync(EventId);
        isLoading = false;
        
        if (eventItem == null)
        {
            NavigationManager.NavigateTo("/");
        }
    }

    private void GoBack() => NavigationManager.NavigateTo("/events");
    private void Register() => NavigationManager.NavigateTo($"/register/{EventId}");
}