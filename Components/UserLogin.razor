@namespace EventEase.Components
@using EventEase.Services
@using System.ComponentModel.DataAnnotations
@inject AppState AppState
@inject NavigationManager NavigationManager

<div class="login-container">
    @if (!AppState.IsLoggedIn)
    {
        <div class="login-card">
            <h3>Welcome to EventEase</h3>
            <p class="subtitle">Please enter your details to get started</p>
            
            <EditForm Model="userInfo" OnValidSubmit="HandleLogin">
                <DataAnnotationsValidator />
                <ValidationSummary />
                
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <InputText id="name" @bind-Value="userInfo.Name" class="form-control" 
                               placeholder="Enter your full name" />
                    <ValidationMessage For="@(() => userInfo.Name)" />
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <InputText id="email" @bind-Value="userInfo.Email" class="form-control" 
                               placeholder="Enter your email" />
                    <ValidationMessage For="@(() => userInfo.Email)" />
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-block" disabled="@isSubmitting">
                        @(isSubmitting ? "Please wait..." : "Get Started")
                    </button>
                </div>
                
                <p class="disclaimer">
                    By continuing, you agree to our Terms of Service and Privacy Policy
                </p>
            </EditForm>
        </div>
    }
    else
    {
        <div class="welcome-message">
            <h3>Welcome back, @AppState.CurrentUser?.Name!</h3>
            <p>You have @AppState.GetUserRegistrationCount() event registration(s)</p>
            <button class="btn btn-outline-secondary btn-sm" @onclick="Logout">
                Sign Out
            </button>
        </div>
    }
</div>

@code {
    private UserLoginModel userInfo = new();
    private bool isSubmitting = false;
    
    private async Task HandleLogin()
    {
        isSubmitting = true;
        await Task.Delay(300); // Simulate processing
        
        AppState.Login(userInfo.Name, userInfo.Email);
        NavigationManager.NavigateTo("/dashboard");
        
        isSubmitting = false;
    }
    
    private void Logout()
    {
        AppState.Logout();
        NavigationManager.NavigateTo("/", forceLoad: true);
    }
    
    public class UserLoginModel
    {
        [Required(ErrorMessage = "Name is required")]
        [StringLength(50, ErrorMessage = "Name is too long")]
        public string Name { get; set; } = string.Empty;
        
        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string Email { get; set; } = string.Empty;
    }
}